<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Star Sales Network (PSSN)</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --green: #2ecc71; --dark: #0f172a; --card: rgba(255, 255, 255, 0.05); }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; transition: 0.3s; }
        body { margin: 0; background: var(--dark); color: white; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 450px; min-height: 100vh; position: relative; border: 1px solid rgba(255,255,255,0.1); }
        input, select, textarea { width: 100%; padding: 14px; background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; margin-bottom: 12px; outline: none; }
        .btn-premium { width: 100%; padding: 16px; background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; margin-bottom: 10px; display: block; text-align: center; text-decoration: none; }
        
        /* Welcome Overlay */
        #welcome-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .welcome-card { background: var(--card); border: 1px solid var(--green); border-radius: 20px; padding: 20px; text-align: center; width: 100%; max-width: 380px; }
        .welcome-logo { width: 100%; border-radius: 10px; margin-bottom: 15px; }
        .instr-en { text-align: left; font-size: 12px; color: #cbd5e1; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border-left: 4px solid var(--green); margin-bottom: 20px; line-height: 1.6; }

        #dashboard { display: none; padding-bottom: 90px; }
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .active-tab { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .balance-card { background: var(--card); padding: 25px; border-radius: 20px; text-align: center; margin: 20px; border: 1px solid rgba(255,255,255,0.05); position: relative; }
        .logout-btn { position: absolute; top: 10px; right: 10px; background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 8px; font-size: 10px; cursor: pointer; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 450px; height: 75px; background: #1e293b; display: flex; z-index: 1000; border-top: 1px solid rgba(255,255,255,0.1); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: #94a3b8; cursor: pointer; }
        .nav-item.active { color: var(--green); }
        .announcement-bar { background: rgba(46, 204, 113, 0.1); color: var(--green); padding: 10px; border-radius: 10px; font-size: 12px; margin: 10px 20px; text-align: center; }
    </style>
</head>
<body>

<div id="welcome-overlay">
    <div class="welcome-card">
        <img src="https://i.ibb.co/LhbV4Vb/FB-IMG-1768455528784.jpg" class="welcome-logo" alt="PSSN Logo">
        <h3 style="color:var(--green); margin:0 0 10px 0;">PSSN INSTRUCTIONS</h3>
        <div class="instr-en">
            ‚Ä¢ <b>How to Earn:</b> Complete simple social media tasks like liking or following pages to earn money for free.<br>
            ‚Ä¢ <b>Submission:</b> You must upload a screenshot as proof after finishing each task.<br>
            ‚Ä¢ <b>Withdrawals:</b> Minimum limit is Rs. 300. Ensure your account details are correct.<br>
            ‚Ä¢ <b>Referrals:</b> Build your Team to increase your daily earning potential.
        </div>
        <button class="btn-premium" onclick="closeWelcome()">PROCEED TO APP</button>
    </div>
</div>

<div class="app-container">
    <div id="auth-screen" style="padding:40px 25px; text-align:center;">
        <h2 style="color:var(--green);">PSSN LOGIN</h2>
        <div id="login-form">
            <input type="number" id="l-phone" placeholder="WhatsApp Number">
            <input type="password" id="l-pass" placeholder="Password">
            <button id="login-btn" class="btn-premium" onclick="enterApp('login')">LOGIN</button>
            <p onclick="toggleAuth(false)" style="font-size:13px; cursor:pointer; color:var(--green);">Register New Account</p>
        </div>
        <div id="register-form" style="display:none;">
            <input type="text" id="r-name" placeholder="Full Name">
            <input type="number" id="r-phone" placeholder="WhatsApp Number">
            <input type="password" id="r-pass" placeholder="Password">
            <input type="text" id="r-ref" placeholder="Referral Code">
            <button id="reg-btn" class="btn-premium" onclick="enterApp('reg')">CREATE ACCOUNT</button>
            <p onclick="toggleAuth(true)" style="font-size:13px; cursor:pointer; color:var(--green);">Already have an account? Login</p>
        </div>
    </div>

    <div id="dashboard">
        <div id="announcement-area" class="announcement-bar">Welcome to Power Star Sales Network!</div>
        
        <div class="balance-card">
            <button class="logout-btn" onclick="logout()">Logout</button>
            <span style="font-size:11px; color:#94a3b8;">TOTAL BALANCE</span>
            <h1 id="main-bal" style="color:var(--green); margin:5px 0;">Rs. 0.00</h1>
        </div>

        <div id="tab-home" class="tab-content active-tab">
            <img id="home-banner" src="https://i.ibb.co/LhbV4Vb/FB-IMG-1768455528784.jpg" style="width:100%; border-radius:15px; border:1px solid var(--green);">
            <div id="task-container" style="margin-top:20px;"></div>
        </div>

        <div id="tab-about" class="tab-content">
            <h3 style="color:var(--green);">About Us</h3>
            <div style="background:var(--card); padding:20px; border-radius:12px; font-size:13px; color:#cbd5e1; line-height:1.7; margin-bottom:15px;">
                PSSN (Power Star Sales Network) is a leading platform for digital task management. We help users earn money online through simple social media engagement. 
            </div>
            <a href="https://whatsapp.com/channel/0029VbBtlLd29752E8E2z10W" target="_blank" class="btn-premium" style="background:#25D366;">WhatsApp Channel</a>
            <a href="https://t.me/+wrV-LempJ39lY2Fk" target="_blank" class="btn-premium" style="background:#0088cc;">Telegram Support</a>
        </div>

        <div id="tab-team" class="tab-content">
            <h3 style="color:var(--green);">My Team</h3>
            <div style="background:var(--card); padding:15px; border-radius:12px; text-align:center; border: 1px dashed var(--green);">
                <span style="font-size:10px; color:var(--green);" id="ref-link">Generating...</span><br>
                <button onclick="copyRef()" style="margin-top:10px; padding:5px 15px; border-radius:5px; border:none; background:var(--green); font-weight:bold;">COPY LINK</button>
            </div>
            <div style="margin-top:20px; background:var(--card); padding:20px; border-radius:12px; text-align:center;">
                <span style="font-size:12px;">ACTIVE MEMBERS</span>
                <h2 id="team-count" style="color:var(--green); margin:5px 0;">0</h2>
            </div>
        </div>

        <div id="tab-wallet" class="tab-content">
            <h3 onclick="checkAdminAccess()" style="cursor:pointer; color:var(--green);">Wallet</h3>
            <div id="bind-section">
                <input type="text" id="acc-name-field" placeholder="Account Title (e.g. Ali Khan)">
                <select id="acc-type-field"><option>EasyPaisa</option><option>JazzCash</option></select>
                <input type="number" id="acc-num-field" placeholder="Account Number">
                <button id="bind-btn" class="btn-premium" onclick="bindAccount()">SAVE ACCOUNT</button>
            </div>
            <div id="saved-acc-display" style="display:none;">
                <div id="acc-details-text" style="background:rgba(46, 204, 113, 0.1); border:1px dashed var(--green); padding:15px; border-radius:12px; text-align:center; color:var(--green); font-weight:bold;">-</div>
                <input type="number" id="withdraw-amt" placeholder="Amount (Min 300)" style="margin-top:20px;">
                <button id="withdraw-btn" class="btn-premium" onclick="requestWithdrawal()">SUBMIT WITHDRAWAL</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="navTo('tab-home', this)">üè†<span>Home</span></div>
            <div class="nav-item" onclick="navTo('tab-about', this)">‚ÑπÔ∏è<span>About Us</span></div>
            <div class="nav-item" onclick="navTo('tab-team', this)">üë•<span>Team</span></div>
            <div class="nav-item" onclick="navTo('tab-wallet', this)">üí∞<span>Wallet</span></div>
        </nav>
    </div>
</div>

<script>
    let currentUserPhone = localStorage.getItem('pssn_phone') || "";
    const SHEETDB_URL = "https://sheetdb.io/api/v1/h0yk6frxj1bdg";

    window.onload = () => {
        if(currentUserPhone) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            fetchUserData();
        }
    };

    function closeWelcome() { document.getElementById('welcome-overlay').style.display = 'none'; }
    function toggleAuth(isLogin) {
        document.getElementById('login-form').style.display = isLogin ? 'block' : 'none';
        document.getElementById('register-form').style.display = isLogin ? 'none' : 'block';
    }

    async function enterApp(type) {
        const phone = (type==='reg')?document.getElementById('r-phone').value : document.getElementById('l-phone').value;
        const pass = (type==='reg')?document.getElementById('r-pass').value : document.getElementById('l-pass').value;
        if(!phone || !pass) return alert("Fill all fields!");

        try {
            const res = await fetch(`${SHEETDB_URL}/search?phone=${phone}`);
            const data = await res.json();

            if(type==='reg') {
                if(data.some(u => u.type_action === "REGISTRATION")) return alert("User already exists!");
                const newUser = { phone, password: pass, acc_name: document.getElementById('r-name').value, balance: "0", type_action: "REGISTRATION", date: new Date().toLocaleString(), status: document.getElementById('r-ref').value || "DIRECT" };
                await fetch(SHEETDB_URL, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({data:[newUser]}) });
            } else {
                const user = data.find(u => u.type_action === "REGISTRATION");
                if(!user || user.password !== pass) return alert("Invalid credentials!");
            }
            localStorage.setItem('pssn_phone', phone);
            currentUserPhone = phone;
            location.reload();
        } catch(e) { alert("Server Error!"); }
    }

    async function fetchUserData() {
        try {
            const res = await fetch(`${SHEETDB_URL}/search?phone=${currentUserPhone}&t=${Date.now()}`);
            const data = await res.json();
            
            const reg = data.find(i => i.type_action === "REGISTRATION");
            if(reg) document.getElementById('main-bal').innerText = "Rs. " + reg.balance;

            const bnd = data.find(i => i.type_action === "ACCOUNT_BIND");
            if(bnd) {
                document.getElementById('bind-section').style.display = "none";
                document.getElementById('saved-acc-display').style.display = "block";
                document.getElementById('acc-details-text').innerText = `${bnd.acc_type}: ${bnd.acc_num}`;
            }

            document.getElementById('ref-link').innerText = window.location.origin + window.location.pathname + "?ref=" + currentUserPhone;
        } catch(e) { console.log("Fetch Error"); }
    }

    async function bindAccount() {
        const n = document.getElementById('acc-name-field').value;
        const t = document.getElementById('acc-type-field').value;
        const num = document.getElementById('acc-num-field').value;
        if(!n || !num) return alert("Please fill account details!");

        const d = { phone: currentUserPhone, acc_name: n, acc_type: t, acc_num: num, type_action: "ACCOUNT_BIND" };
        await fetch(SHEETDB_URL, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({data:[d]}) });
        alert("Account Saved!"); fetchUserData();
    }

    function logout() { localStorage.removeItem('pssn_phone'); location.reload(); }
    function navTo(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active-tab'); el.classList.add('active');
        if(id === 'tab-wallet' || id === 'tab-team') fetchUserData();
    }
    function copyRef() { navigator.clipboard.writeText(document.getElementById('ref-link').innerText); alert("Link Copied!"); }
</script>
</body>
</html>
